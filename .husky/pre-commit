#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit Quality Check Pipeline
# This hook ensures code quality before committing changes
# First runs all tests, then checks code formatting and conventional commits

# 1. TypeScript Type Checking
echo "ğŸ“ Checking TypeScript types..."
pnpm type-check || { echo "âŒ Type check failed. Please fix type errors."; exit 1; }

# 2. Unit Tests (Vitest)
echo "ğŸ§ª Running unit tests..."
pnpm test || { echo "âŒ Unit tests failed. Please fix failing tests."; exit 1; }

# Once all tests pass, check code quality
echo "âœ¨ Tests passed! Now checking code quality..."

# 4. Full Codebase Format Check
echo "ï¿½ Checking code formatting..."
pnpm format || { echo "âŒ Format check failed. Run 'pnpm format:fix' to fix issues."; exit 1; }

# 5. Staged Files and Conventional Commit Check
echo "ğŸ” Running lint-staged and commit checks..."
pnpm lint-staged || { echo "âŒ Lint-staged checks failed. Please fix the issues and follow conventional commit format."; exit 1; }

echo "âœ… All pre-commit quality checks passed successfully!"

